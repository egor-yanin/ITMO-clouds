# Лабораторная 2 

Написать плохой и хороший докер-файлы, описать, почему они таковыми являются, рассказать про плохие пракики работы с контейнером

## Плохой докер-файл:

<img width="438" height="175" alt="image" src="https://github.com/user-attachments/assets/dd02e9ac-958e-48b4-826a-d9b04d7d9506" />


- 1 плохая практика: Неправильный образ контейнера

  Чаще всего при работе с контейнерами нам не нужна полная копия образа, который мы собираемся использовать для запуска, а только определенные
  его функции. В таких случаях хорошей практикой будет использовать минимальные образы, например, для простых приложений, alpine, debian, или облегченные образы с пометкой -slim.
  
  Дополнительно: Лучше не использовать latest в указании версии, ведь тогда есть шанс, что при очередной пересборке образ соберется неправильно в силу изменений в версии, и получится то,
  во избежание чего мы вообще пользуемся контейнерами: "А у меня на компьютере оно работает"

  В нашем случае для запуска контейнера вполне было достаточно debian-slim, а из-за того что мы скачивали последнюю версию ubuntu образ собирался невыносимо долго в первый раз и занял очень много места в памяти, что недопустимо

- 2 плохая практика: Множественные RUN

  Каждый RUN добавляет новый слой в наш файл, из-за чего он работает дольше. Логически совместимые RUN лучше прописывать в одной строке, чтобы не тратить драгоценные ресурсы на работу с слоями. В нашем случае,
  учитывая, что команд немного, это не окажет существенной нагрузки на систему, но в случае больших докер-файлов для сложных приложений это может вызвать неприятные последствия

- 3 плохая практика: Ненужные пакеты и дейсвия

  В данной работе это конечно несколько притянуто за уши, но все же стоит упомянуть, что писать докер-файл, это вам не кодик на питончике начиркать - подключил ненужную библиотеку, не удалил ненужную строчку,
  ну и ладно, на производительности толком не сказалось. Каждый пакет, который мы усанавливаем, добавляе огромное количесство времени к уже и без того огромному (после установки образа то) сборки. В нашем случае
  нам совершенно ни к чему php-fpm и совершенно не нужно копировать файлы

- 4 плохая практика: Нет очистки кэша

  Кэш - чаще всего ненужные файлы, остающиеся после других процессов. Они обычно не занимают так много места но все же их можно подчищать ради экономии ресурсов. У нас в коде этого просто нет

## Хороший докер-файл:

<img width="681" height="186" alt="image" src="https://github.com/user-attachments/assets/b1729de1-593c-4694-b9d3-a5cbd4859cc6" />

Мы используем нужную версию, один RUN, стираем кэш и не устанавливаем ненужных пакетов.

Разница очевидна во времени сборки и чуть менее заметна для непосредственно работы контейнера, но и там она есть, что наглядно демонстрирует влияние плохих практик написания докер-файла на работу конейнера

<img width="1204" height="527" alt="Screenshot from 2025-12-25 15-23-56" src="https://github.com/user-attachments/assets/d7f1d982-e60e-4798-82ad-0e44ab252b7e" />

<img width="1204" height="140" alt="Screenshot from 2025-12-25 15-45-56" src="https://github.com/user-attachments/assets/9a5729a8-80e6-4982-93c2-3b7beb4916b3" />

<img width="1204" height="228" alt="Screenshot from 2025-12-25 16-28-23" src="https://github.com/user-attachments/assets/587e9ac3-35d1-4ca3-ac07-11b27406d353" />

<img width="1204" height="124" alt="Screenshot from 2025-12-25 16-25-30" src="https://github.com/user-attachments/assets/82779717-8496-48fe-b7cf-84cd719fa924" />

## Плохие практики работы с контейнерами:

Однако даже хороший докер-файл не гарантия потрясающей эффективной работы контейнера - накосячить можно где угодно. 

- 1 плохая практика: Несколько процессов в одном контейнере

Принципы ООП, про один файл - один класс, один класс - одна задача, нашли меня и здесь. Один контейнер должен содержать и курировать один процесс - ели вам нужно много процессов из разных контейнеров, воспользуйтесь 
Docker Compose

- 2 плохая практика: Внесение данных в контейнер

Данные в контейнере хранить нельзя, они удалятся при перезапуске - все постоянные данные должны храниться во внешних системах: базах данных, томах, облачных хранилищах.

# Вывод

Чтобы у вас не крашнулась виртуальная (а не дай бог и не виртуальная) машина, пишите хорошие докер-файлы)
